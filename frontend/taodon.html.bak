<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tạo đơn hàng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <div class="container py-4">
    <h3 class="mb-4">🧾 Tạo đơn hàng</h3>

    <form id="orderForm" class="mb-4">
      <div class="mb-3">
        <label for="customerName" class="form-label">Tên khách hàng</label>
        <input type="text" class="form-control" id="customerName" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Chọn món ăn</label>
        <div id="productGallery" class="d-flex flex-wrap gap-3"></div>
      </div>

      <div class="mb-3">
        <label class="form-label">Món đã chọn</label>
        <div id="selectedItems"></div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Tạo đơn hàng</button>
        <button type="button" class="btn btn-secondary" id="resetBtn">Nhập lại</button>
      </div>
    </form>

    <h5>📋 Đơn hàng đã tạo</h5>
    <div id="orderResult"></div>
  </div>

  <script>
    const categories = JSON.parse(localStorage.getItem('categories')) || [];
    const gallery = document.getElementById('productGallery');
    const selected = document.getElementById('selectedItems');
    const form = document.getElementById('orderForm');
    const result = document.getElementById('orderResult');
    const resetBtn = document.getElementById('resetBtn');

    const selectedMap = new Map();

    categories.forEach(item => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${item.image}" alt="${item.name}">
        <div><strong>${item.name}</strong><br>Giá: ${parseInt(item.price).toLocaleString()} VNĐ</div>
      `;
      card.onclick = () => {
        if (selectedMap.has(item.name)) return;

        const row = document.createElement('div');
        row.className = 'order-row';
        row.innerHTML = `
          <strong>${item.name}</strong> – ${parseInt(item.price).toLocaleString()} VNĐ
          <input type="number" min="1" value="1" class="form-control d-inline-block w-auto ms-2">
          <button class="btn btn-danger btn-sm ms-2">Xóa</button>
        `;
        row.querySelector('button').onclick = () => {
          selectedMap.delete(item.name);
          row.remove();
        };
        selected.appendChild(row);
        selectedMap.set(item.name, { ...item, row });
      };
      gallery.appendChild(card);
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('customerName').value;
      if (!name.trim()) return alert("Vui lòng nhập tên khách hàng.");

      if (selectedMap.size === 0) return alert("Vui lòng chọn ít nhất một món.");

      const items = [];
      selectedMap.forEach((item, key) => {
        const qty = item.row.querySelector('input').value;
        if (qty && parseInt(qty) > 0) {
          items.push({ name: key, price: item.price, qty });
        }
      });

      const div = document.createElement('div');
      div.className = 'order-item';
      div.innerHTML = `
        <div class="p-3 border rounded mb-3 bg-light">
          <strong>Khách hàng:</strong> ${name}<br>
          <strong>Món hàng:</strong>
          <ul>
            ${items.map(i => `<li>${i.name} – ${i.qty} x ${parseInt(i.price).toLocaleString()} VNĐ</li>`).join('')}
          </ul>
        </div>
      `;
      result.appendChild(div);
      form.reset();
      selected.innerHTML = '';
      selectedMap.clear();
    });

    resetBtn.onclick = function() {
      form.reset();
      selected.innerHTML = '';
      selectedMap.clear();
      result.innerHTML = '';
    };
  </script>

  <!-- Thanh menu dưới -->
  <nav class="navbar fixed-bottom navbar-light bg-light border-top">
    <div class="container d-flex justify-content-around">
      <a href="home.html" class="text-center text-decoration-none">
        <i class="bi bi-house"></i><br>Đơn hàng
      </a>
      <a href="taodon.html" class="text-center text-decoration-none">
        <i class="bi bi-receipt"></i><br>Tạo đơn
      </a>
      <a href="danhmuc.html" class="text-center text-decoration-none">
        <i class="bi bi-box-seam"></i><br>Danh mục
      </a>
      <a href="#" class="text-center text-decoration-none">
        <i class="bi bi-graph-up"></i><br>Thống kê
      </a>
      <a href="#" class="text-center text-decoration-none">
        <i class="bi bi-gear"></i><br>Cài đặt
      </a>
    </div>
  </nav>
</body>
</html>
